name: RDP

on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9999

    steps:
    - name: Install Chrome Remote Desktop
      run: |
        $Method = "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi"
        Invoke-WebRequest -Uri $Method -OutFile "crd.msi"
        Start-Process msiexec.exe -Wait -ArgumentList "/i crd.msi /quiet"

    - name: Configure and Start CRD
      run: |
        & "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe" `
        --code="4/0ASc3gC3kvkFpbZDz7RCx6GEE8dLuiA6yZswelq2Chn2ccqGPyERo4WieeiOT0kPCLOxSpw" `
        --redirect-url="https://remotedesktop.google.com/_/oauthredirect" `
        --name="Mobile-RDP" `
        --pin=123456 `
        --non-interactive

    - name: Silent Infinite Loop
      run: |
        write-host "RDP registered. Keep-alive loop starting..."
        conhost.exe --headless powershell.exe -Command "while($true) { Start-Sleep -Seconds 60 }"
