name: RDP

on: workflow_dispatch

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 9999

    steps:
    - name: Install Chrome Remote Desktop
      run: |
        $Method = "https://dl.google.com/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi"
        Invoke-WebRequest -Uri $Method -OutFile "crd.msi"
        Start-Process msiexec.exe -Wait -ArgumentList "/i crd.msi /quiet"

    - name: Authorize and Start Host
      run: |
        & "${Env:PROGRAMFILES(X86)}\Google\Chrome Remote Desktop\CurrentVersion\remoting_start_host.exe" `
        --code="4/0ASc3gC3VRjq9s-Tdvi39X7PqqvnQjAY8PZQpeaTBxCoCdCZayTKVFukn6JwcElXfrKuM9Q" `
        --redirect-url="https://remotedesktop.google.com/_/oauthredirect" `
        --name=$Env:COMPUTERNAME `
        --pin=123456 `
        --non-interactive

    - name: Keep Alive
      run: |
        while ($true) {
          Write-Host "RDP Session Active..."
          Start-Sleep -Seconds 60
        }
